import {
  Examples,
  Input,
  Output,
  Figure,
  PostLayout,
  Solution,
  Subtask,
} from "components";

export const meta = {
  title: "숨겨진 층",
  year: 2020,
  stage: "본선",
};

export default ({ children }) => (
  <PostLayout meta={meta}>{children}</PostLayout>
);

요정 웡키는 숨겨진 반지를 얻기 위해 해저 던전 더 시드를 탐험하다 숨겨진 층을 발견하였다.

숨겨진 층은 가로 $W$ 세로 $H$ 크기의 2차원 직사각형 맵으로 구성되어있고 $N$ 마리의 숲의 요정과 $M$ 마리의 식충 슬라임이 살고 있다. 맵의 왼쪽 아래 꼭짓점을 $(0, 0)$이라 하면 우측으로 $x$, 위로 $y$ 만큼 떨어져 있는 위치를 $(x, y)$로 표현할 수 있다. $i$ 번째 숲의 요정은 $(a_i, b_i)$에서 이동하지 않고, $i$ 번째 식충 슬라임은 $(c_i, d_i)$에서 이동하지 않는다.

요정 웡키는 최대 $K$ 마리의 숲의 요정들을 맵 밖으로 순간이동 시킨 후, 특별한 스킬을 한 번 사용해서 모든 숲의 요정들이 화나지 않게 하면서 최대한 많은 식충 슬라임을 사냥하려 한다. 특별한 스킬은 맵 내부에 있는 직사각형 영역을 선택해 해당 직사각형 영역 내에 존재하는 모든 식충 슬라임을 사냥할 수 있고, 해당 직사각형의 경계를 제외한 영역 내에 존재하는 모든 숲의 요정은 화가 나게 된다. 이때, 직사각형 경계에 존재하는 식충 슬라임은 사냥할 수 있고 직사각형 영역의 경계에 존재하는 숲의 요정은 화나지 않는다.

즉, $0 \le x_1 \lt x_2 \le W$; $0 \le y_1 \lt y_2 \le H$를 만족하는 $(x_1,y_1)$을 왼쪽 아래 꼭짓점, $(x_2,y_2)$를 오른쪽 위 꼭짓점으로 갖는 직사각형 영역에 스킬을 사용하면 $x_1 \lt a_i \lt x_2$를 만족하며 $y_1 \lt b_i \lt y_2$를 만족하는 숲의 요정은 화가 나게 된다.

또한 $0 \le x_1 \lt x_2 \le W$; $0 \le y_1 \lt y_2 \le H$를 만족하는 $(x_1,y_1)$을 왼쪽 아래 꼭짓점, $(x_2,y_2)$를 오른쪽 위 꼭짓점으로 갖는 직사각형 영역에 스킬을 사용하면 $x_1 \le c_i \leq x_2$를 만족하며 $y_1 \le d_i \le y_2$를 만족하는 식충 슬라임을 모두 사냥할 수 있다.

요정 웡키를 도와 모든 숲의 요정이 화가 나지 않게 하면서 최대한 많은 식충 슬라임을 사냥할 수 있게 직사각형 영역을 정해주자. 만약 숲의 요정이 화나지 않게 하면서 최대한 많은 식충 슬라임을 사냥 할 수 있는 직사각형 영역이 여러 개 존재한다면, 가장 넓이가 넓은 직사각형 영역을 구해주자.

## 입력 형식

첫 줄에 맵의 크기를 나타내는 $W$와 $H$, 숲의 요정의 마리수를 나타내는 $N$, 식충 슬라임의 마리수를 나타내는 $M$, 웡키가 순간이동 시킬 수 있는 숲의 요정의 최대 마리수를 나타내는 $K$가 공백으로 구분되어 주어진다. ($1 \le W, H \le 1\,000\,000\,000$; $1 \le N, M \le 1\,000$; $0 \le K \le 10$)

그 이후 $N$ 개의 줄에 걸쳐 $i$ 번째 숲의 요정의 위치를 나타내는 $a_i$, $b_i$가 공백으로 구분되어 주어진다. ($0 \le a_i \le W$; $0 \le b_i \le H$)

그 이후 $M$ 개의 줄에 걸쳐 $i$ 번째 식충 슬라임의 위치를 나타내는 $c_i$, $d_i$가 공백으로 구분되어 주어진다. ($0 \le c_i \le W$; $0 \le d_i \le H$)

주어지는 모든 위치는 서로 다르다는 것이 보장된다.

## 출력 형식

첫 줄에 잡을 수 있는 식충 슬라임의 최대 마리수와 해당 직사각형 영역의 넓이를 공백을 두고 출력한다.

## 예제 1

<Examples>
  {/* prettier-ignore */}
  <Input>
10 10 4 4 0
1 3
9 3
5 1
5 9
5 2
5 3
1 5
10 5
  </Input>
  {/* prettier-ignore */}
  <Output>
3 64
  </Output>
</Examples>

## 예제 2

<Examples>
  {/* prettier-ignore */}
  <Input>
10 10 4 4 1
1 3
9 3
5 1
5 9
5 2
5 3
1 5
10 5
  </Input>
  {/* prettier-ignore */}
  <Output>
4 72
  </Output>
</Examples>

## 예제 설명

아래는 입력 예제 1과 2에 대한 그림이다. 숲의 요정은 빨간 점, 식충 슬라임은 파란 점으로 표현 되었고 선택한 직사각형 영역은 회색으로 음영처리 되었다.

<Figure
  src="/2020/hidden1.png"
  caption="<그림 1> 예제 1에 대한 그림"
  width={400}
/>

<Figure
  src="/2020/hidden2.png"
  caption="<그림 2> 예제 2에 대한 그림"
  width={400}
/>

## 채점 방식

입력 케이스들은 다음과 같은 종류로 구별되며, 한 종류의 케이스를 다 맞추어야 그 종류에 배정된 점수를 받을 수 있다.

<Subtask index={1} score={17}>
  $N,M \le 100$
</Subtask>
<Subtask index={2} score={23}>
  $N,M \le 300$
</Subtask>
<Subtask index={3} score={21}>
  $K=0$
</Subtask>
<Subtask index={4} score={39}>
  추가적인 제한 조건이 없음.
</Subtask>

## 해설

<Solution>
좌표 압축을 한 후 누적합을 이용하면 임의의 직사각형에 대해 몇 마리의 슬라임이 존재하는지 $\mathcal{O}(1)$에 구할 수 있다.
정답이 되는 직사각형의 왼쪽변은 맵의 왼쪽변에 접하거나, 요정의 위치에 접하고 해당 점의 후보의 개수는 최대 $2 \times R$개인 것을 알 수 있다.

그럼 직사각형의 왼쪽 변에 접하는 점을 고정한 후 해당 점보다 오른쪽에 있는 모든 요정의 위치에 대해 각 $y$좌표에 몇 마리의 요정이 있는지 $y$좌표순으로 정렬된 링크드 리스트 형태로 구해둔다.

그 이후 각 $y$좌표에 대해 해당되는 노드의 주소를 저장해둔 후, 오른쪽에서 왼쪽으로 같은 $x$좌표를 갖는 요정들을 한번에 리스트에서 뺀 후, 결정했던 점에 해당되는 노드를 기준으로 최대 $K$개를 포함하도록 투 포인터를 이용해 구해주면 $\mathcal{O}(R^2 K)$에 문제를 해결할 수 있다.

</Solution>
