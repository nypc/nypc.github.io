import {
  Examples,
  Input,
  Output,
  Figure,
  PostLayout,
  Solution,
  Subtask,
} from "components";

export const meta = {
  title: "영역 나누기",
  year: 2021,
  stage: "예선",
};

export default ({ children }) => (
  <PostLayout meta={meta}>{children}</PostLayout>
);

원주 위에 $2N$ 개의 점들이 놓여 있다. 각 점에는 $1$ 이상 $N$ 이하의 번호가 붙어 있고, 같은 번호가 붙은 점은 정확히 두 개 있다. 같은 번호가 붙은 점끼리 직선으로 이으면, 원 내부의 영역이 이 직선에 의해 나누어진다.

아래 그림을 보면 $8$ 개의 점이 원주 상에 어떻게 배치되어 있는가에 따라 나누어진 원 내부 영역의 개수가 달라진다. 왼쪽 그림에서는 원 내부가 $7$ 개의 영역으로 나누어진 반면, 오른쪽 그림에선 $11$ 개의 영역으로 나누어졌다. 넓이가 $0$인 영역은 고려하지 않음에 유의하라.

<Figure
  src="/2021/divide01-24453bd3.png"
  caption="&lt;그림 1&gt; 원주 위의 8개의 점과 이를 이은 선들로 원을 나눈 예"
  width={720}
/>

이처럼 원주 상에 배치된 $2N$ 개의 점에 대한 정보가 주어질 때, 위에서 설명한 방법에 따라 그은 직선들에 의해 원 내부의 영역이 최대 몇 개로 나누어 지는지를 구하라.

## 입력 형식

첫 줄에 정수 $N$이 주어진다. ($1 \le N \le 500\,000$)

이는 원주 위에 점 $2N$ 개가 있다는 뜻이다.

둘째 줄에 $2N$ 개의 정수가 공백으로 구분되어 주어진다. 이 수들은 $1$ 이상 $N$ 이하이며, 하나의 수는 정확하게 두 번 나타난다. 이는 원주 위의 한 점부터 시작해서, 시계 방향으로 원주 위의 점들의 정보를 읽은 것이다. 점들의 위치는 상대적이고, 순서를 지키는 한 자유롭게 정할 수 있음에 유의하라.

## 출력 형식

첫 줄에 주어진 점들의 정보로 원 내부의 영역을 최대로 나눌 수 있는 개수를 출력한다.

## 예제

<Examples>
  {/* prettier-ignore */}
  <Input>
2
2 2 1 1
  </Input>
  {/* prettier-ignore */}
  <Output>
3
  </Output>
</Examples>

## 예제 설명

<Figure
  src="/2021/divide02-3c54afda.png"
  caption="&lt;그림 2&gt; 입력 예제"
  width={280}
/>

위 예제는 원 위의 한 점 $2$에서 시작해서, 시계 방향으로 이동하면서 가장 먼저 만나는 점이 $2$라는 뜻이다. $1$이 쓰여진 점 둘은 모두 $2$를 잇는 직선에 대해서 같은 방향에 있기 때문에, $1$을 이은 직선은 $2$를 이은 직선과 교차하지 않는다. 따라서 두 직선에 의해서 원은 세 부분으로 나누어진다.

## 채점 방식

입력 케이스들은 다음과 같은 종류로 구별되며, 한 종류의 케이스를 다 맞추어야 그 종류에 배정된 점수를 받을 수 있다.

<Subtask index={1} score={43}>
  $N \le 5\,000$
</Subtask>
<Subtask index={2} score={28}>
  $N \le 50\,000$
</Subtask>
<Subtask index={3} score={29}>
  추가적인 제한 조건이 없음.
</Subtask>

## 해설

<Solution>
평면그래프에서 $V-E+F=2$임을 이용해 $F$값을 구하는 문제다. 주어진 선분 중에서 두 선분이 교차해서 생기는 교점의 개수를 $c$라고 하면, 식을 정리했을 때 $F=n+c+1$이 나오므로 교점의 개수를 구해보자.

원의 한 부분을 끊어 직선으로 보자. 두 선분의 교점은 선분 끝점의 종류가 abab 형태로 나열 될 때 하나 생긴다. 그러므로 직선의 왼쪽에서 오른쪽을 훑어보면서 다음의 작업을 한다.

1. 해당 점이 어떤 선분의 양 끝점 중 첫 번째로 등장했다면 : 해당 위치에 $+1$
2. 해당 점이 어떤 선분의 양 끝점 중 두 번째로 등장했다면 : 선분에 해당하는 범위에 $+1$이 되어 있는 만큼 교점이 생기므로 합을 구해 $c$에 더해줌(abab에서 a사이에 있는 b의 개수를 센 것), $+1$ 했던 위치에 $-1$(이후 등장하는 선분과는 교점이 생길 수 없기 때문)

이는 모두 구간 트리를 통해 $\mathcal{O}(\log N)$에 처리할 수 있는 동작들이므로, 총 $\mathcal{O}(N \log N)$의 시간에 문제를 해결할 수 있다.

</Solution>
