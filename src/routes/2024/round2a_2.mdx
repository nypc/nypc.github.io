---
title: 루시드의 레이저 공격을 피해라!
year: 2024
stage: Round 2-A
bikoId: 4711
---


<div style={{ display: "flex" }}>
  <Figure
    src="/2024/11-2.defd2bb93d84a154.png"
    width={400}
  />
</div>

루시드는 레이저를 이용하여 여러분의 움직임을 방해하려고 한다.

여러분은 처음에 2차원 공간의 $(r_s, c_s)$ 위치에 있고,
$(r_e, c_e)$ 위치로 이동하려고 한다.
반드시 $x$축이나 $y$축에 평행하게 이동해야 하는 것은 아님에 유의하라.
그러나 이동 과정에서 레이저를 지나갈 수는 없다.
시작점이나 도착점에 레이저가 있는 경우는 처음부터 이동이 불가능하다.
레이저는 두 점을 지나가는 무한히 긴 직선이며,
수직인 직선이거나,
수평인 직선이거나,
기울기가 45도로 기울어진 대각선이다.
루시드는 레이저를 총 $M$ 번 쏘고,
루시드가 쏜 레이저는 사라지지 않는다.

시작점 $(r_s, c_s)$와 도착점 $(r_e, c_e)$로 이루진 쿼리 $Q$ 개가 주어졌을 때,
시작점에서 도착점으로 이동 가능한지 판별하는 프로그램을 작성하라.

<div style={{ display: "flex" }}>
  <Figure
    src="/2024/11-1.927bfc88671796ea.png"
    width={280}
  />
</div>

위 그림에서 루시드가 쏜 세 레이저는
파란 직선으로 표시되어 있고,
각각 $(3, 1)$과 $(5, 3)$을 지나는 직선,
$(4, 1)$과 $(1, 4)$를 지나는 직선,
$(1, 4)$와 $(5, 4)$를 지나는 직선이다.
빨간 원으로 표현된 $(2, 1)$에서 출발하여 $(1, 3)$으로 레이저를 맞지 않고 갈 수 있다.
반면, 초록색 원으로 표현된 $(3, 3)$에서 출발하여 $(2, 2)$으로 레이저를 피해서 이동하는 것은 불가능하다.


## 입력 형식

첫 줄에 2차원 공간의 크기를 나타내는 정수 $N$,
레이저의 수를 나타내는 정수 $M$,
쿼리의 수를 나타내는 정수 $Q$가
공백으로 구분되어 주어진다.
($2 \le N \le 1\,000\,000\,000;$
$1 \le M, Q \le 200\,000$)

이어지는 $M$ 개의 줄의 $i$ 번째 줄에는
$i$ 번째 레이저에 대한 정보를 나타내는
네 정수 $r_1$, $c_1$, $r_2$, $c_2$가
공백으로 구분되어 주어진다.
이는 $i$ 번째 레이저가 $(r_1, c_1)$과 $(r_2, c_2)$를 연결하는 직선임을 의미한다.
이때, $r_1 = r_2$, $c_1 = c_2$, $r_1 + c_1 = r_2 + c_2$, $r_1 - c_1 = r_2 - c_2$ 중 정확히 하나를 만족한다.
($1 \le r_1, c_1, r_2, c_2 \le N$)

이어지는 $Q$ 개의 줄의 $i$ 번째 줄에는
$i$ 번째 쿼리에 대한 정보를 나타내는
네 정수 $r_s$, $c_s$, $r_e$, $c_e$가
공백으로 구분되어 주어진다.
($1 \le r_s, c_s, r_e, c_e \le N;$ $(r_s, c_s) \ne (r_e, c_e)$)

## 출력 형식

$Q$ 개의 줄에 걸쳐 답을 출력한다.
$i$ 번째 줄에는 $i$ 번째 쿼리에 대한 답을 출력한다.
만약, 시작점 $(r_s, c_s)$에서 도착점 $(r_e, c_e)$로
이동이 가능하면 `1`, 아니면 `0`을 출력한다.

## 예제 1

<Examples>
  {/* prettier-ignore */}
  <Input>
5 3 2
3 1 5 3
4 1 1 4
1 4 5 4
2 1 1 3
3 3 2 2
  </Input>
  {/* prettier-ignore */}
  <Output>
1
0
  </Output>
</Examples>

## 예제 2

<Examples>
  {/* prettier-ignore */}
  <Input>
5 2 3
3 1 3 2
1 3 2 3
1 1 2 2
2 2 4 4
2 2 3 3
  </Input>
  {/* prettier-ignore */}
  <Output>
1
0
0
  </Output>
</Examples>

## 채점 방식

입력 케이스들은 다음과 같은 종류로 구별되며, 한 종류의 케이스를 다 맞혀야 그 종류에 배정된 점수를 받을 수 있다.

<Subtask index={1} score={31}>
  $N, M, Q \leq 300;$ $r_1 = r_2$ 이거나 $c_1 = c_2$
</Subtask>
<Subtask index={2} score={35}>
  $N, M \leq 2\,000;$ $r_1 = r_2$ 이거나 $c_1 = c_2$
</Subtask>
<Subtask index={3} score={23}>
  $M \le 2\,000;$ $Q \le 2\,000$
</Subtask>
<Subtask index={4} score={11}>
  추가적인 제한 조건이 없음.
</Subtask>

## 해설

<Solution>
만약 $x$축과 평행한 직선만 주어진다면 주어진 두 점의 $y$ 좌표 $y_1$와 $y_2$ 사이에 직선이 있는지 판별하면 되고,
이분 탐색을 이용하면 $\mathcal{O} \left( \lg M \right)$에 확인할 수 있다.
마찬가지로 $y$축에 평행한 직선이 주어지더라도 $x$ 좌표에 대한 이분 탐색을 통해 $\mathcal{O} \left( \lg M \right)$ 시간에 확인할 수 있다.

직선의 기울기가 45도 또는 135도로 기울어진 대각선으로 주어지는 경우,
일차 함수로 해석해서 $y$절편을 이용해 이분 탐색을 해도 되고,
$(x, y)$를 $(x+y, x-y)$로 바꾸는 등의 방법으로 좌표계를 45도 회전시킨 뒤,
$x$축 또는 $y$축에 평행한 직선처럼 처리해도 된다.

전체 시간복잡도는 $\mathcal{O}\left( Q \lg M \right)$이다.
</Solution>
